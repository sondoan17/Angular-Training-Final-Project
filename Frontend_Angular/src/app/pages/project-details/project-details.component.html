<div class="bg-gray-100 min-h-screen p-4 sm:p-6 lg:p-8">
  <div class="max-w-7xl mx-auto">
    <button
      mat-button
      (click)="goBack()"
      class="mb-4 flex items-center text-gray-600 hover:text-gray-800"
    >
      <mat-icon class="mr-2">arrow_back</mat-icon> Back to Dashboard
    </button>

    <div *ngIf="project" class="bg-white shadow rounded-lg p-6">
      <!-- Project Header -->
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">{{ project.name }}</h2>
        <div class="space-x-2">
          <button
            mat-raised-button
            color="primary"
            (click)="openEditProjectDialog()"
            class="edit-button"
          >
            <mat-icon>edit</mat-icon>
            <span class="button-text">Edit Project</span>
          </button>
          <button
            mat-raised-button
            color="accent"
            (click)="openMembersDialog()"
            class="members-button"
          >
            <mat-icon>group</mat-icon>
            <span class="button-text">Members</span>
          </button>
        </div>
      </div>

      <!-- Project Description and Details -->
      <p class="text-gray-600 mb-4">{{ project.description }}</p>
      <div class="flex justify-between text-sm text-gray-500 mb-6">
        <p>Created by: {{ getCreatorUsername() }}</p>
        <p>Created at: {{ project.createdAt | date }}</p>
      </div>

      <!-- Project Progress and Summary -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <!-- Project Progress -->
        <div *ngIf="chartData" class="bg-white p-6 rounded-lg shadow">
          <h3 class="text-lg font-semibold text-gray-700 mb-4">Project Progress</h3>
          
          <!-- Progress Bar -->
          <div class="mb-4">
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700">Overall Progress</span>
              <span class="text-sm font-medium text-gray-700">{{ getCompletionRate() }}%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
              <div class="bg-blue-600 h-2.5 rounded-full" [style.width]="getCompletionRate() + '%'"></div>
            </div>
          </div>

          <!-- Key Metrics -->
          <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="bg-gray-50 p-3 rounded-lg">
              <p class="text-sm text-gray-500">Tasks Completed</p>
              <p class="text-xl font-semibold">{{ getTaskCountByStatus('Done') }} / {{ project.tasks?.length }}</p>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg">
              <p class="text-sm text-gray-500">Days Remaining</p>
              <p class="text-xl font-semibold">{{ getDaysRemaining() }}</p>
            </div>
          </div>

          <!-- Doughnut Chart -->
          <div class="chart-container" style="position: relative; height:200px; width:200px; margin: auto;">
            <canvas baseChart
              [data]="chartData"
              [options]="chartOptions"
              [type]="'doughnut'">
            </canvas>
          </div>
        </div>

        <!-- Project Summary -->
        <div class="bg-white p-4 rounded-lg shadow">
          <h3 class="text-lg font-semibold text-gray-700 mb-4">Project Summary</h3>
          <ul class="space-y-2">
            <li class="flex justify-between">
              <span>Total Tasks:</span>
              <span class="font-medium">{{ project.tasks?.length || 0 }}</span>
            </li>
            <li class="flex justify-between">
              <span>Not Started:</span>
              <span class="font-medium">{{ getTaskCountByStatus('Not Started') }}</span>
            </li>
            <li class="flex justify-between">
              <span>In Progress:</span>
              <span class="font-medium">{{ getTaskCountByStatus('In Progress') }}</span>
            </li>
            <li class="flex justify-between">
              <span>Stuck:</span>
              <span class="font-medium">{{ getTaskCountByStatus('Stuck') }}</span>
            </li>
            <li class="flex justify-between">
              <span>Completed:</span>
              <span class="font-medium">{{ getTaskCountByStatus('Done') }}</span>
            </li>
            <li class="flex justify-between">
              <span>Team Members:</span>
              <span class="font-medium">{{ project.members?.length || 0 }}</span>
            </li>
            <li class="flex justify-between">
              <span>Project Duration:</span>
              <span class="font-medium">{{ getProjectDuration() }}</span>
            </li>
            <li class="flex justify-between">
              <span>Completion Rate:</span>
              <span class="font-medium">{{ getCompletionRate() }}%</span>
            </li>
          </ul>
        </div>
      </div>

      <!-- Tasks Section -->
      <div class="mb-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold text-gray-700">Tasks</h3>
          <div>
            <button mat-raised-button color="primary" (click)="openCreateTaskDialog()" class="mr-2">
              <mat-icon>add</mat-icon>
              <span>Create Task</span>
            </button>
            <button mat-raised-button color="accent" (click)="toggleView()">
              <mat-icon>{{ isKanbanView ? 'view_list' : 'view_module' }}</mat-icon>
              <span>{{ isKanbanView ? 'Table View' : 'Kanban View' }}</span>
            </button>
          </div>
        </div>
        
        <app-kanban-board *ngIf="isKanbanView"
          [tasks]="project.tasks"
          [projectId]="project._id"
          (taskMoved)="onTaskMoved($event)">
        </app-kanban-board>

        <app-task-table *ngIf="!isKanbanView"
          [tasks]="project.tasks"
          [projectId]="project._id"
          (taskMoved)="onTaskMoved($event)">
        </app-task-table>
      </div>

      <!-- Activity Log Toggle -->
      <div class="activity-log-toggle-container mt-6">
        <button mat-raised-button color="primary" (click)="toggleActivityLog()" class="activity-log-toggle">
          <mat-icon>{{ isActivityLogVisible ? 'visibility_off' : 'visibility' }}</mat-icon>
          {{ isActivityLogVisible ? 'Hide Activity Log' : 'Show Activity Log' }}
        </button>
      </div>

      <!-- Activity Log -->
      <div *ngIf="isActivityLogVisible" class="mt-6">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">Activity Log</h3>
        <mat-list>
          <mat-list-item *ngFor="let log of activityLog" class="mb-2 bg-gray-50 rounded">
            <div class="flex flex-col">
              <div class="flex items-center">
                <mat-icon class="mr-2 text-gray-600">history</mat-icon>
                <span class="text-sm text-gray-600">{{ log.timestamp | date:'medium' }}</span>
              </div>
              <div class="ml-6 mt-1">
                <span class="text-sm font-medium text-gray-800">{{ log.performedBy.username }}</span>
                <span class="text-sm text-gray-600 ml-2" [innerHTML]="formatActivityAction(log.action)"></span>
              </div>
            </div>
          </mat-list-item>
        </mat-list>
        <mat-paginator
          [length]="totalLogs"
          [pageSize]="pageSize"
          [pageIndex]="currentPage - 1"
          (page)="onPageChange($event)"
        >
        </mat-paginator>
      </div>
    </div>
  </div>
</div>
